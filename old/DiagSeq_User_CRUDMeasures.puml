'Consulter relevé
     @startuml
          skinparam ParticipantPadding 20
          skinparam responseMessageBelowArrow true
          skinparam maxMessageSize 300
          '!theme spacelab
          hide footbox
          autonumber
     
          actor "Utilisateur:Utilisateur" as user
          participant ":Interface" as interf
          participant ":Relevés" as system
          participant ":DB" as db
          title __"Utilisateur"__: consulter un relevé
          activate user
                  activate interf
                          activate system
                                  activate db
                                          user -> interf : demande la page de consultation d'un relevé
                                          interf -> system : Envoie de la requête utilisateur
                                          system -> db : obtention des permissions de l'utilisateur
                                          db --> system : renvoie des permissions
                                          system -> system : vérification des permissions
                                          alt permissions insuffisantes
                                                  system --> interf: permission insuffisante
                                                  interf --> user: renvoie message "Vous ne disposez pas des permissions nécessaires pour effectuer cette action"
                                          else permissions suffisantes
                                                  system --> interf: permission suffisante
                                                  interf --> user : renvoie formulaire  pour consulter relevé
                                                  loop données non conformes ou relevé n'existe pas dans la BD
                                                          user -> interf:  soumettre formulaire
                                                          interf -> system:  validation des données
                                                          system -> system: validation du formulaire
                                                          alt données du formulaire conformes au modèle business relevé
                                                                  system->db: vérification de l'existence préalable du  relevé
                                                                  alt relevé existe
                                                                          db-->system: relevé existe


                                                                                  system-->interf: réussite: le relevé a été trouvée
                                                                                  interf -> user: renvoie message "Le relevé a été trouvée." + renvoie les détails du relevé

                                                                  else relevé n'existe pas
                                                                          db-->system: relevé n'existe pas
                                                                  deactivate db
                                                                  destroy db
                                                                  system-->interf: erreur: relevé n'existe pas
                                                                  interf -> user: renvoie message d'erreur "Ce relevé n'existe pas." + formulaire pour consulter relevé
                                                          end
                                                  else données non conformes
                                                          system-->interf: données du formulaire soumis sont invalides + détail des erreurs par champ
                                                  deactivate system
                                                  destroy system
                                                  interf --> user:  renvoie formulaire rempli pour éditer un relevé + un message d'erreur par champ invalide
                                          deactivate user
                                          destroy user
                                  deactivate interf
                                  destroy interf
                          end
                  end
          end
          @enduml


'Créer relevé
@startuml
     skinparam ParticipantPadding 20
     skinparam responseMessageBelowArrow true
     skinparam maxMessageSize 300
     '!theme spacelab
     hide footbox
     autonumber

     actor "Utilisateur:Utilisateur" as user
     participant ":Interface" as interf
     participant ":Relevés" as system
     participant ":DB" as db
     title __"Utilisateur"__: créer un nouveau relevé
     activate user
             activate interf
                     activate system
                             activate db
                                     user -> interf : demande la page de création d'un nouveau relevé
                                     interf -> system : Envoie de la requête utilisateur
                                     system -> db : obtention des permissions de l'utilisateur
                                     db --> system : renvoie des permissions
                                     system -> system : vérification des permissions
                                     alt permissions insuffisantes
                                             system --> interf: permission insuffisante
                                             interf --> user: renvoie message "Vous ne disposez pas des permissions nécessaires pour effectuer cette action"
                                     else permissions suffisantes
                                             system --> interf: permission suffisante
                                             interf --> user : renvoie formulaire vide pour créer relevé
                                             loop données non conformes ou relevé existe déjà dans la BD
                                                     user -> interf:  soumettre formulaire rempli
                                                     interf -> system:  validation des données
                                                     system -> system: validation du formulaire
                                                     alt données du formulaire conformes au modèle business relevé
                                                             system->db: vérification de l'unicité du nouveau relevé
                                                             alt relevé est unique
                                                                     db-->system: relevé est unique
                                                                     system->db: débute la transaction
                                                                     system->db: exécute la modification
                                                                     system->db: commit la transaction
                                                                     alt transaction réussie
                                                                             db-->system: transaction réussie
                                                                             system-->interf: réussite: le relevé a été sauvegardé
                                                                             interf -> user: renvoie message "Le relevé a été sauvegardé." + renvoie formulaire vide pour créer relevé
                                                                     else transaction échouée
                                                                             db-->system: transaction refusée
                                                                             system->db: rollback la modification
                                                                             system-->interf: création du relevé échouée
                                                                             interf-->user: renvoie message d'erreur + formulaire rempli pour créer un nouveau relevé
                                                                     end
                                                             else relevé existe déjà
                                                                     db-->system: relevé existe déjà
                                                             deactivate db
                                                             destroy db
                                                             system-->interf: erreur: relevé existe déjà
                                                             interf -> user: renvoie message d'erreur "Ce relevé existe déjà." + formulaire rempli pour créer un nouveau relevé
                                                     end
                                             else données non conformes
                                                     system-->interf: données du formulaire soumis sont invalides + détail des erreurs par champ
                                             deactivate system
                                             destroy system
                                             interf --> user:  renvoie formulaire rempli pour créer un nouveau relevé + un message d'erreur par champ invalide
                                     deactivate user
                                     destroy user
                             deactivate interf
                             destroy interf
                     end
             end
     end
     @enduml
     
     'Éditer relevé
     @startuml
          skinparam ParticipantPadding 20
          skinparam responseMessageBelowArrow true
          skinparam maxMessageSize 300
          '!theme spacelab
          hide footbox
          autonumber
     
          actor "Utilisateur:Utilisateur" as user
          participant ":Interface" as interf
          participant ":Relevés" as system
          participant ":DB" as db
          title __"Utilisateur"__: éditer un relevé
          activate user
                  activate interf
                          activate system
                                  activate db
                                          user -> interf : demande la page d'édition d'un relevé
                                          interf -> system : Envoie de la requête utilisateur
                                          system -> db : obtention des permissions de l'utilisateur
                                          db --> system : renvoie des permissions
                                          system -> system : vérification des permissions
                                          alt permissions insuffisantes
                                                  system --> interf: permission insuffisante
                                                  interf --> user: renvoie message "Vous ne disposez pas des permissions nécessaires pour effectuer cette action"
                                          else permissions suffisantes
                                                  system --> interf: permission suffisante
                                                  interf --> user : renvoie formulaire  pour éditer relevé
                                                  loop données non conformes ou relevé n'existe pas dans la BD
                                                          user -> interf:  soumettre formulaire rempli
                                                          interf -> system:  validation des données
                                                          system -> system: validation du formulaire
                                                          alt données du formulaire conformes au modèle business relevé
                                                                  system->db: vérification de l'existence préalable du  relevé
                                                                  alt relevé existe
                                                                          db-->system: relevé existe
                                                                          system->db: débute la transaction
                                                                          system->db: exécute la modification
                                                                          system->db: commit la transaction
                                                                          alt transaction réussie
                                                                                  db-->system: transaction réussie
                                                                                  system-->interf: réussite: le relevé a été sauvegardé
                                                                                  interf -> user: renvoie message "Le relevé a été sauvegardé." + renvoie formulaire  pour éditer relevé
                                                                          else transaction échouée
                                                                                  db-->system: transaction refusée
                                                                                  system->db: rollback la modification
                                                                                  system-->interf: édition du relevé échouée
                                                                                  interf-->user: renvoie message d'erreur + formulaire rempli pour éditer un relevé
                                                                          end
                                                                  else relevé n'existe pas
                                                                          db-->system: relevé n'existe pas
                                                                  deactivate db
                                                                  destroy db
                                                                  system-->interf: erreur: relevé n'existe pas
                                                                  interf -> user: renvoie message d'erreur "Ce relevé n'existe pas." + formulaire rempli pour éditer un relevé
                                                          end
                                                  else données non conformes
                                                          system-->interf: données du formulaire soumis sont invalides + détail des erreurs par champ
                                                  deactivate system
                                                  destroy system
                                                  interf --> user:  renvoie formulaire rempli pour éditer un relevé + un message d'erreur par champ invalide
                                          deactivate user
                                          destroy user
                                  deactivate interf
                                  destroy interf
                          end
                  end
          end
          @enduml


          'Supprimer relevé
               @startuml
                    skinparam ParticipantPadding 20
                    skinparam responseMessageBelowArrow true
                    skinparam maxMessageSize 300
                    '!theme spacelab
                    hide footbox
                    autonumber

                    actor "Utilisateur:Utilisateur" as user
                    participant ":Interface" as interf
                    participant ":Relevés" as system
                    participant ":DB" as db
                    title __"Utilisateur"__: supprimer un relevé
                    activate user
                            activate interf
                                    activate system
                                            activate db
                                                    user -> interf : demande la page de suppression d'un relevé
                                                    interf -> system : Envoie de la requête utilisateur
                                                    system -> db : obtention des permissions de l'utilisateur
                                                    db --> system : renvoie des permissions
                                                    system -> system : vérification des permissions
                                                    alt permissions insuffisantes
                                                            system --> interf: permission insuffisante
                                                            interf --> user: renvoie message "Vous ne disposez pas des permissions nécessaires pour effectuer cette action"
                                                    else permissions suffisantes
                                                            system --> interf: permission suffisante
                                                            interf --> user : renvoie formulaire  pour supprimer relevé
                                                            loop données non conformes ou relevé n'existe pas dans la BD
                                                                    user -> interf:  soumettre formulaire rempli
                                                                    interf -> system:  validation des données
                                                                    system -> system: validation du formulaire
                                                                    alt données du formulaire conformes au modèle business relevé
                                                                            system->db: vérification de l'existence préalable du  relevé
                                                                            alt relevé existe
                                                                                    db-->system: relevé existe
                                                                                    system->db: débute la transaction
                                                                                    system->db: exécute la modification
                                                                                    system->db: commit la transaction
                                                                                    alt transaction réussie
                                                                                            db-->system: transaction réussie
                                                                                            system-->interf: réussite: le relevé a été supprimé
                                                                                            interf -> user: renvoie message "Le relevé a été supprimé." + renvoie formulaire  pour supprimer relevé
                                                                                    else transaction échouée
                                                                                            db-->system: transaction refusée
                                                                                            system->db: rollback la modification
                                                                                            system-->interf: suppression du relevé échouée
                                                                                            interf-->user: renvoie message d'erreur + formulaire rempli pour supprimer un relevé
                                                                                    end
                                                                            else relevé n'existe pas
                                                                                    db-->system: relevé n'existe pas
                                                                            deactivate db
                                                                            destroy db
                                                                            system-->interf: erreur: relevé n'existe pas
                                                                            interf -> user: renvoie message d'erreur "Ce relevé n'existe pas." + formulaire rempli pour supprimer un relevé
                                                                    end
                                                            else données non conformes
                                                                    system-->interf: données du formulaire soumis sont invalides + détail des erreurs par champ
                                                            deactivate system
                                                            destroy system
                                                            interf --> user:  renvoie formulaire rempli pour supprimer un relevé + un message d'erreur par champ invalide
                                                    deactivate user
                                                    destroy user
                                            deactivate interf
                                            destroy interf
                                    end
                            end
                    end
                    @enduml
